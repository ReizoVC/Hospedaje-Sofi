{% extends "staff_layout.html" %}
{% block title %}Inventario | Almacenista{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/almacenista/inventario.css') }}">
{% endblock %}

{% block content %}
<section class="inventario">
  <div class="container">
    <div class="content-header">
      <h1 class="titulo-seccion">Inventario</h1>
      <button id="btn-nuevo" class="btn btn-primary">+ Nuevo producto</button>
    </div>

    <section class="stats-container">
      <div class="stat-card">
        <div class="stat-number" id="stat-productos">0</div>
        <div class="stat-label">Productos</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="stat-bajos">0</div>
        <div class="stat-label">Bajo stock</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="stat-porvencer">0</div>
        <div class="stat-label">Por vencer ≤ 15d</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="stat-stock">0</div>
        <div class="stat-label">Stock total</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="stat-costototal">S/ 0</div>
        <div class="stat-label">Costo total</div>
      </div>
    </section>

    

    <div class="tabs">
      <button class="tab-btn active" data-tab="tab-disponibles">Disponibles</button>
      <button class="tab-btn" data-tab="tab-vencidos">Vencidos</button>
    </div>

    <div id="tab-disponibles" class="tab-panel active">
      <div class="tabla-wrapper">
        <table class="tabla">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Costo unitario</th>
              <th>Costo total</th>
              <th>Cantidad</th>
              <th>Umbral</th>
              <th>Vence</th>
              <th>Días</th>
              <th>Estado</th>
              <th style="width: 140px;">Acciones</th>
            </tr>
          </thead>
          <tbody id="tbody-productos">
            <tr><td colspan="10" style="text-align:center; padding: 1rem;">Cargando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div id="tab-vencidos" class="tab-panel">
      <div class="tabla-wrapper">
        <table class="tabla">
          <thead>
            <tr>
              <th>ID Lote</th>
              <th>Producto</th>
              <th>Cantidad actual</th>
              <th>Cantidad inicial</th>
              <th>Vencimiento</th>
              <th>Costo unitario</th>
              <th>Ingreso</th>
            </tr>
          </thead>
          <tbody id="tbody-vencidos">
            <tr><td colspan="7" style="text-align:center; padding: 1rem;">Cargando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<!-- Modal Nuevo/Editar Producto -->
<div id="modalProducto" class="modal" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalProductoTitulo">Nuevo producto</h3>
      <span class="close" data-close="modalProducto">&times;</span>
    </div>
    <div class="modal-body">
      <form id="formProducto">
        <input type="hidden" id="prod-id" />
        <div class="form-row">
          <label>Nombre del producto</label>
          <input id="prod-nombre" type="text" required />
        </div>
        
        <!-- Campos solo para nuevo producto -->
        <div class="form-row" id="prod-cantidad-row" style="display: none;">
          <label>Cantidad inicial</label>
          <input id="prod-cantidad" type="number" min="0" value="0" />
        </div>
        <div class="form-row" id="prod-costo-row" style="display: none;">
          <label>Costo unitario</label>
          <input id="prod-costo" type="number" step="1" min="0" value="0" />
        </div>
        <div class="form-row" id="prod-fv-row" style="display: none;">
          <label>Fecha de vencimiento</label>
          <input id="prod-fv" type="date" />
        </div>
        <div class="form-row" id="prod-sin-fv-row" style="display: none;">
          <label style="display:flex;align-items:center;gap:.5rem;font-weight:500;color:#374151">
            <input id="prod-sin-fv" type="checkbox" /> Sin fecha de vencimiento
          </label>
        </div>
        
        <!-- Campo para edición -->
        <div class="form-row">
          <label>Umbral mínimo</label>
          <input id="prod-umbral" type="number" min="0" value="0" />
        </div>
      </form>
      
      <h4 style="margin-top: 1.5rem; margin-bottom: 0.75rem; display: none;" id="lotes-header">Seleccionar lote para editar:</h4>
      <div id="lotes-list" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 0.375rem; padding: 0.5rem; display: none;">
        <p style="text-align: center; color: #999; padding: 1rem;">Cargando lotes...</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-sec" data-close="modalProducto">Cancelar</button>
      <button id="btn-guardar-producto" class="btn-primary">Guardar</button>
    </div>
  </div>
</div>

<!-- Modal Eliminar Lote -->
<div id="modalEliminarLote" class="modal" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Eliminar Lote del Producto</h3>
      <span class="close" data-close="modalEliminarLote">&times;</span>
    </div>
    <div class="modal-body">
      <p style="margin-bottom: 1rem; color: #666;">Selecciona el lote que deseas eliminar:</p>
      <div id="lotes-eliminar-list" style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 0.375rem; padding: 0.5rem;">
        <p style="text-align: center; color: #999; padding: 1rem;">Cargando lotes...</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-sec" data-close="modalEliminarLote">Cancelar</button>
    </div>
  </div>
</div>

<!-- Modal Editar Lote -->
<div id="modalEditarLote" class="modal" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Editar Lote #<span id="lote-id-display">0</span></h3>
      <span class="close" data-close="modalEditarLote">&times;</span>
    </div>
    <div class="modal-body">
      <form id="formEditarLote">
        <input type="hidden" id="lote-id" />
        <div class="form-row">
          <label>Cantidad actual</label>
          <input id="lote-cantidad-actual" type="number" min="0" required />
        </div>
        <div class="form-row">
          <label>Costo unitario</label>
          <input id="lote-costo" type="number" step="1" min="0" required />
        </div>
        <div class="form-row">
          <label>Fecha de vencimiento</label>
          <input id="lote-fv" type="date" />
        </div>
        <div class="form-row">
          <label style="display:flex;align-items:center;gap:.5rem;font-weight:500;color:#374151">
            <input id="lote-sin-fv" type="checkbox" /> Sin fecha de vencimiento
          </label>
        </div>
        <div class="form-row" style="background: #f3f4f6; border-radius: 0.375rem; padding: 0.75rem; margin-top: 1rem;">
          <label style="margin-bottom: 0; color: #666;">Información del lote:</label>
          <p style="font-size: 0.875rem; color: #666; margin: 0.25rem 0;">
            <strong>Ingreso:</strong> <span id="lote-fecha-ingreso">-</span>
          </p>
          <p style="font-size: 0.875rem; color: #666; margin: 0.25rem 0;">
            <strong>Estado:</strong> <span id="lote-estado" style="padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">-</span>
          </p>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn-sec" data-close="modalEditarLote">Cancelar</button>
      <button id="btn-guardar-lote" class="btn-primary">Guardar lote</button>
    </div>
  </div>
</div>

<!-- Modal Movimiento -->
<div id="modalMovimiento" class="modal" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Registrar movimiento</h3>
      <span class="close" data-close="modalMovimiento">&times;</span>
    </div>
    <div class="modal-body">
      <form id="formMovimiento">
        <input type="hidden" id="mov-idproducto" />
        <div class="form-row">
          <label>Tipo</label>
          <select id="mov-tipo">
            <option value="entrada">Entrada</option>
            <option value="salida">Salida</option>
            <option value="ajuste">Ajuste</option>
          </select>
        </div>
        <div class="form-row">
          <label>Cantidad</label>
          <input id="mov-cantidad" type="number" min="1" value="1" />
        </div>
        <div class="form-row">
          <label>Costo unitario</label>
          <input id="mov-costo" type="number" step="1" min="0" value="0" />
        </div>
        <div class="form-row">
          <label>Fecha de vencimiento</label>
          <input id="mov-fv" type="date" />
        </div>
        <div class="form-row">
          <label style="display:flex;align-items:center;gap:.5rem;font-weight:500;color:#374151">
            <input id="mov-sin-fv" type="checkbox" /> Sin fecha de vencimiento
          </label>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn-sec" data-close="modalMovimiento">Cancelar</button>
      <button id="btn-registrar-mov" class="btn-primary">Registrar</button>
    </div>
  </div>
</div>


{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/almacenista/inventario.js') }}"></script>
{% endblock %}
